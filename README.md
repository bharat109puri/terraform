# Terraform [WIP]

Terraform configuration for the Recrd base infrastructure

## Developer guide

[You can find the developer guide here](./developer_guide.md)

## Plan

```shell
cd users
aws-vault exec recrd/admin -- terragrunt plan
```

## Terragrunt vs Terraform Cloud

We need to decide which one to use.

Currently there are traces of Terragrunt, but the code is prepared to be ready to be used with Terraform Cloud.

### Update process

We need to define how to update:
- providers
- modules

Currently each version is managed inside the workspace.

## Lock files

You only need to do this on new workspaces and when providers are getting updated.

The `.terraform.lock.hcl` are generated by the following process:

```shell
aws-vault exec recrd/admin -- terraform init
rm .terraform.lock.hcl
terraform providers lock -platform=darwin_amd64 -platform=darwin_arm64 -platform=linux_amd64 -platform=windows_amd64
git add .terraform.lock.hcl
```

### Transitive dependencies

Providers required by 3rd party modules are currently not locked in the workspaces.

The Terraform lock files guarantee they are consistent across workstations. When providers are getting updated they are going to be automatically updated too.
If required they can be locked to a specific version during the provider update process.

---

## Links

- [Terraform](https://www.terraform.io/)
- [Terragrunt](https://terragrunt.gruntwork.io/)
- [aws-vault](https://github.com/99designs/aws-vault)
