# IAM User management

This configuration defines IAM Users and their access.

## User Guide

### How to request an IAM user

1. Request in `#infra` Slack channel for a new user to be provisioned with the following details:

   ```text
   New user request for AWS IAM User
   ---------------------------------
   email:
   when this is needed by:
   ```

2. Once created, the user will receive an email with instructions for setting up an AWS IAM User.

## Admin guide

1. Add user to appropriate input variable and apply terraform.
2. Find user in [IAM](https://us-east-1.console.aws.amazon.com/iamv2/home#/users).
3. Go to "Security Credentials" tab and click "Console password".
4. Set the following and then click "Apply".

   ```text
   Console access: Enable
   Set password: Autogenerated password
   Require password reset: [x]
   ```

5. Save the `.csv` file.
6. Take the auto-generated password from the screen or the `.csv` and create a [OneTimeSecret](https://onetimesecret.com/) link with lifetime of 1 day.
6. Insert the password link into the following template and send this to the same email as the username. Do not attach the `.csv`.

   <Details>
     <Summary>Email template</Summary>

    **Subject**: Your AWS IAM User for Recrd has been created

    An IAM user has been created for you to access the AWS account for Recrd.

    - Sign-in URL: https://378942204220.signin.aws.amazon.com/console
    - User name: your email address (where you received this email)
    - Password (link expires within 24 hours): **[REPLACE WITH LINK]**

    Setup instructions:
    1. Log in using the [Sign-in URL](https://378942204220.signin.aws.amazon.com/console)
    2. Change your password
    3. Add an MFA device (see [documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html))
    4. Sign out
    5. Log back in with your new password and MFA

    Your user has very limited access, please assume the appropriate role to see/manage any services or resources. See [documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html) for more details.

    In case you have an issue or you received this email as an error, please contact us via `#infra` on Slack.
   </Details>